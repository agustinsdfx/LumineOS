<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LumineOS 1.0</title>
    <style>
        :root {
            --taskbar-bg: rgba(243, 243, 243, 0.85);
            --taskbar-text: #000;
            --taskbar-hover: rgba(0, 0, 0, 0.1);
            --window-bg: #ffffff;
            --window-header: #f0f0f0;
            --window-text: #333;
            --modal-bg: #fff;
            --input-bg: #fff;
            --input-text: #000;
            --glass-border: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --taskbar-bg: rgba(30, 30, 30, 0.90);
            --taskbar-text: #ffffff;
            --taskbar-hover: rgba(255, 255, 255, 0.15);
            --window-bg: #202020;
            --window-header: #2d2d2d;
            --window-text: #e0e0e0;
            --modal-bg: #202020;
            --input-bg: #333;
            --input-text: #fff;
            --glass-border: 1px solid rgba(255, 255, 255, 0.15);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', sans-serif;
            background-image: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop');
            background-size: cover; background-position: center;
            height: 100vh; overflow: hidden; user-select: none;
            color: var(--taskbar-text); transition: color 0.3s;
        }

        #lumine-watermark {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px; font-weight: 200;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 5px 15px rgba(0,0,0,0.3);
            pointer-events: none; z-index: 0;
            font-family: 'Segoe UI Light', sans-serif; letter-spacing: 5px;
        }

        #desktop {
            position: relative; z-index: 1;
            display: flex; flex-direction: column; flex-wrap: wrap;
            height: calc(100vh - 50px); padding: 10px; gap: 15px;
            align-content: flex-start;
        }

        .icon {
            position: relative; width: 74px; height: 95px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            border-radius: 4px; cursor: pointer;
            transition: background 0.2s; color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }
        .icon:hover { background: rgba(255, 255, 255, 0.15); }

        .delete-shortcut-btn {
            position: absolute; top: -5px; right: -5px;
            width: 20px; height: 20px; background: red;
            color: white; border-radius: 50%; display: none;
            align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3); z-index: 10;
        }

        .external-link-btn {
            position: absolute; bottom: 25px; left: -5px;
            width: 22px; height: 22px; background: #0078d4;
            color: white; border-radius: 50%; display: none;
            align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3); z-index: 10;
        }

        .icon:hover .delete-shortcut-btn, 
        .icon:hover .external-link-btn { display: flex; }
        
        .icon .placeholder-icon {
            width: 44px; height: 44px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 22px; font-weight: bold; margin-bottom: 8px;
            color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            overflow: hidden; 
        }

        .icon img.custom-icon-img {
            width: 44px; height: 44px; border-radius: 8px;
            object-fit: cover; margin-bottom: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .icon span {
            font-size: 12px; text-align: center; line-height: 1.2;
            overflow: hidden; text-overflow: ellipsis;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
        }

        #taskbar {
            position: absolute; bottom: 0; width: 100%; height: 48px;
            background: var(--taskbar-bg); backdrop-filter: blur(20px);
            border-top: var(--glass-border); z-index: 1000;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; box-sizing: border-box; color: var(--taskbar-text);
        }

        .tb-left, .tb-right { flex: 1; display: flex; align-items: center; }
        .tb-right { justify-content: flex-end; }
        .tb-center { flex: 0 0 auto; display: flex; gap: 6px; }
        .tb-left { gap: 10px; }

        .taskbar-icon {
            width: 40px; height: 40px; border-radius: 4px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: background 0.2s;
        }
        .taskbar-icon:hover { background: var(--taskbar-hover); }

        .close-all-icon:hover { background: rgba(232, 17, 35, 0.2); color: #e81123; }
        
        #clock-container {
            display: flex; flex-direction: column; align-items: flex-end;
            justify-content: center; font-size: 12px; padding: 0 10px;
            cursor: default; height: 100%;
        }
        #clock-container:hover { background: var(--taskbar-hover); border-radius: 4px;}

        .window {
            position: absolute; width: 800px; height: 600px;
            background: var(--window-bg); color: var(--window-text);
            border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            display: flex; flex-direction: column; overflow: hidden;
            animation: popIn 0.2s cubic-bezier(0.1, 0.9, 0.2, 1);
            resize: both; min-width: 300px;
            border: 1px solid rgba(128, 128, 128, 0.2);
            z-index: 100;
        }
        @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .title-bar {
            height: 32px; background: var(--window-header);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 0 0 12px; cursor: default; font-size: 13px;
        }

        .window-controls { display: flex; height: 100%; }
        .control-btn {
            width: 45px; height: 100%; display: flex;
            justify-content: center; align-items: center;
            cursor: pointer; font-size: 14px;
        }
        .close-btn:hover { background: #e81123; color: white; }

        .window-content { flex: 1; background: #fff; position: relative; }
        iframe { width: 100%; height: 100%; border: none; }

        .modal {
            display: none; position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%); background: var(--modal-bg);
            color: var(--window-text); padding: 24px; border-radius: 8px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.6); z-index: 2000;
            width: 320px; border: 1px solid rgba(128, 128, 128, 0.3);
        }
        
        input {
            width: 100%; padding: 10px; margin: 5px 0 15px 0;
            border: 1px solid #888; border-radius: 4px;
            background: var(--input-bg); color: var(--input-text);
            box-sizing: border-box;
        }

        .modal-buttons { display: flex; justify-content: flex-end; gap: 10px; }
        button { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #0078d4; color: white; }
        .btn-cancel { background: #e0e0e0; color: #000; }

        .toggle-container { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .toggle-switch {
            position: relative; width: 44px; height: 22px;
            background: #767676; border-radius: 22px; cursor: pointer; transition: 0.3s;
        }
        .toggle-switch::after {
            content: ''; position: absolute; top: 3px; left: 3px;
            width: 16px; height: 16px; background: white; border-radius: 50%; transition: 0.3s;
        }
        .toggle-active { background: #0078d4; }
        .toggle-active::after { left: 25px; }
    </style>
</head>
<body>

    <div id="lumine-watermark">LumineOS 1.0</div>

    <div id="desktop">
        <div class="icon" id="add-icon" onclick="openModal('add-modal')">
            <div class="placeholder-icon" style="background: #333;">+</div>
            <span>Agregar</span>
        </div>

        <div class="icon shortcut" data-name="DuckDuckGo Lite" data-url="https://lite.duckduckgo.com/lite/" onclick="createWindow(this.dataset.name, this.dataset.url)">
            <div class="delete-shortcut-btn" onclick="deleteShortcut(event, this)">✕</div>
            <div class="external-link-btn" onclick="openExternal(event, 'https://lite.duckduckgo.com/lite/')"><svg width="12" height="12" viewBox="0 0 24 24" fill="white"><path d="M19 19H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg></div>
            <div class="placeholder-icon" style="background: #e37151;">D</div>
            <span>DuckDuckGo</span>
        </div>

        <div class="icon shortcut" data-name="Wikipedia" data-url="https://es.wikipedia.org" onclick="createWindow(this.dataset.name, this.dataset.url)">
            <div class="delete-shortcut-btn" onclick="deleteShortcut(event, this)">✕</div>
            <div class="external-link-btn" onclick="openExternal(event, 'https://es.wikipedia.org')"><svg width="12" height="12" viewBox="0 0 24 24" fill="white"><path d="M19 19H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg></div>
            <div class="placeholder-icon" style="background: #fff; color:black;">W</div>
            <span>Wikipedia</span>
        </div>

        <div class="icon shortcut" data-name="Crazy Games" data-url="https://www.crazygames.com" onclick="createWindow(this.dataset.name, this.dataset.url)">
            <div class="delete-shortcut-btn" onclick="deleteShortcut(event, this)">✕</div>
            <div class="external-link-btn" onclick="openExternal(event, 'https://www.crazygames.com')"><svg width="12" height="12" viewBox="0 0 24 24" fill="white"><path d="M19 19H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg></div>
            <div class="placeholder-icon" style="background: #6a0dad;">C</div>
            <span>Crazy Games</span>
        </div>
    </div>

    <div id="taskbar">
        <div class="tb-left">
            <div class="taskbar-icon" title="Configuración" onclick="openModal('settings-modal')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
            </div>
            
            <div class="taskbar-icon" title="Guardar Cambios" onclick="saveSystem()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                </svg>
            </div>
        </div>

        <div class="tb-center">
            <div class="taskbar-icon start-btn" title="Inicio" onclick="openHome()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#0078d4">
                    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" fill="none"/>
                    <circle cx="12" cy="12" r="4" fill="currentColor"/>
                </svg>
            </div>
            <div class="taskbar-icon" title="Explorador" onclick="openFiles()">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="#e8b931"><path d="M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/></svg>
            </div>
            <div class="taskbar-icon close-all-icon" title="Cerrar Todo" onclick="closeAllWindows()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </div>
        </div>

        <div class="tb-right">
            <div id="clock-container">
                <div id="time">00:00</div>
                <div id="date">00/00/0000</div>
            </div>
        </div>
    </div>

    <div id="add-modal" class="modal">
        <h3>Nuevo Acceso Directo</h3>
        <label>Nombre:</label>
        <input type="text" id="app-name" autocomplete="off">
        <label>URL Web:</label>
        <input type="text" id="app-url" autocomplete="off">
        <label>URL Icono (Opcional):</label>
        <input type="text" id="app-icon" autocomplete="off" placeholder="https://...">
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeModal('add-modal')">Cancelar</button>
            <button class="btn-primary" onclick="addShortcut()">Crear</button>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <h3>Configuración</h3>
        <div class="toggle-container">
            <span>Modo Oscuro</span>
            <div id="theme-toggle" class="toggle-switch" onclick="toggleTheme()"></div>
        </div>
        <label>Fondo URL:</label>
        <input type="text" id="bg-url">
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeModal('settings-modal')">Cerrar</button>
            <button class="btn-primary" onclick="applyBackground()">Aplicar</button>
        </div>
    </div>

    <script>
        function openHome() { window.open('https://www.google.com', '_blank'); }
        function openFiles() { window.open('https://github.com', '_blank'); }

        function updateClock() {
            const now = new Date();
            document.getElementById('time').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('date').innerText = now.toLocaleDateString();
        }
        setInterval(updateClock, 1000); updateClock();

        let isDarkMode = false;
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
            document.getElementById('theme-toggle').classList.toggle('toggle-active');
        }
        function applyBackground() {
            const url = document.getElementById('bg-url').value;
            if(url) document.body.style.backgroundImage = `url('${url}')`;
        }

        let zIndexCounter = 100;
        function createWindow(name, url) {
            if (!url.startsWith('http')) url = 'https://' + url;
            const id = 'win-' + Date.now();
            const win = document.createElement('div');
            win.classList.add('window');
            win.id = id;
            win.style.left = (window.innerWidth / 2 - 400 + (Math.random()*40 - 20)) + 'px';
            win.style.top = (window.innerHeight / 2 - 300 + (Math.random()*40 - 20)) + 'px';
            win.style.zIndex = ++zIndexCounter;

            win.innerHTML = `
                <div class="title-bar" onmousedown="startDrag(event, '${id}')">
                    <span class="title-bar-text">${name}</span>
                    <div class="window-controls">
                        <div class="control-btn close-btn" onclick="closeWindow('${id}')">✕</div>
                    </div>
                </div>
                <div class="window-content" onclick="focusIframe(this)">
                    <iframe src="${url}" 
                        sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-pointer-lock allow-modals allow-presentation allow-orientation-lock"
                        allow="autoplay; encrypted-media; fullscreen; clipboard-read; clipboard-write; gamepad; gyroscope; accelerometer; xr-spatial-tracking; microphone; camera; midi"
                        allowfullscreen="true">
                    </iframe>
                </div>
            `;
            win.addEventListener('mousedown', () => win.style.zIndex = ++zIndexCounter);
            document.body.appendChild(win);
        }

        function focusIframe(container) {
            const iframe = container.querySelector('iframe');
            if(iframe) iframe.focus();
        }

        function closeWindow(id) { document.getElementById(id).remove(); }
        function closeAllWindows() { document.querySelectorAll('.window').forEach(w => w.remove()); }

        function openModal(id) { document.getElementById(id).style.display = 'block'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        function addShortcut() {
            const name = document.getElementById('app-name').value;
            const url = document.getElementById('app-url').value;
            const iconUrl = document.getElementById('app-icon').value;
            if (name && url) {
                renderShortcut(name, url, iconUrl);
                document.getElementById('app-name').value = '';
                document.getElementById('app-url').value = '';
                document.getElementById('app-icon').value = '';
                closeModal('add-modal');
            }
        }

        function renderShortcut(name, url, iconUrl) {
             const desktop = document.getElementById('desktop');
             const newIcon = document.createElement('div');
             newIcon.className = 'icon shortcut'; 
             newIcon.dataset.name = name;
             newIcon.dataset.url = url;
             newIcon.dataset.icon = iconUrl || '';
             
             const color = ['#d83b01', '#0078d4', '#107c10', '#5c2d91', '#008272'][Math.floor(Math.random()*5)];
             const arrowIcon = `<svg width="12" height="12" viewBox="0 0 24 24" fill="white"><path d="M19 19H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>`;

             let visualIcon = `<div class="placeholder-icon" style="background:${color}">${name[0].toUpperCase()}</div>`;
             if(iconUrl) {
                visualIcon = `<img src="${iconUrl}" class="custom-icon-img" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
                              <div class="placeholder-icon" style="background:${color}; display:none;">${name[0].toUpperCase()}</div>`;
             }

             newIcon.innerHTML = `
                <div class="delete-shortcut-btn" onclick="deleteShortcut(event, this)">✕</div>
                <div class="external-link-btn" onclick="openExternal(event, '${url}')">${arrowIcon}</div>
                ${visualIcon}
                <span>${name}</span>
             `;
             newIcon.onclick = () => createWindow(name, url);
             desktop.appendChild(newIcon);
        }

        function deleteShortcut(event, element) {
            event.stopPropagation();
            element.parentElement.remove();
        }

        function openExternal(event, url) {
            event.stopPropagation();
            if (!url.startsWith('http')) url = 'https://' + url;
            window.open(url, '_blank');
        }

        function saveSystem() {
            const theme = isDarkMode ? 'dark' : 'light';
            const bg = document.body.style.backgroundImage;
            const shortcuts = [];
            document.querySelectorAll('.icon.shortcut').forEach(icon => {
                shortcuts.push({
                    name: icon.dataset.name,
                    url: icon.dataset.url,
                    icon: icon.dataset.icon
                });
            });

            const data = { theme, bg, shortcuts };
            localStorage.setItem('lumineOS_v1', JSON.stringify(data));
            
            const btn = document.querySelector('[onclick="saveSystem()"]');
            const originalColor = btn.style.color;
            btn.style.color = '#00ff00';
            setTimeout(() => { btn.style.color = originalColor || 'inherit'; alert("Sistema Guardado."); }, 200);
        }

        function loadSystem() {
            const data = JSON.parse(localStorage.getItem('lumineOS_v1'));
            if(!data) return; 

            if(data.theme === 'dark' && !isDarkMode) toggleTheme();

            if(data.bg) document.body.style.backgroundImage = data.bg;

            const desktop = document.getElementById('desktop');
            const addIcon = document.getElementById('add-icon');
            desktop.innerHTML = ''; 
            desktop.appendChild(addIcon); 

            if(data.shortcuts && data.shortcuts.length > 0) {
                data.shortcuts.forEach(s => renderShortcut(s.name, s.url, s.icon));
            }
        }

        let isDragging = false, currentWindow = null, offsetX = 0, offsetY = 0;
        function startDrag(e, id) {
            if(e.target.classList.contains('control-btn')) return;
            isDragging = true;
            currentWindow = document.getElementById(id);
            const rect = currentWindow.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            currentWindow.style.zIndex = ++zIndexCounter;
        }
        document.addEventListener('mousemove', (e) => {
            if (isDragging && currentWindow) {
                e.preventDefault();
                currentWindow.style.left = (e.clientX - offsetX) + 'px';
                currentWindow.style.top = (e.clientY - offsetY) + 'px';
            }
        });
        document.addEventListener('mouseup', () => { isDragging = false; currentWindow = null; });

        loadSystem();

    </script>
</body>
</html>